
<!DOCTYPE html>
<html>
<head>
	<title>Game</title>
	<link rel="stylesheet" href="styles.css">
</head>


<body>

<div class="container">
	<img src="Images/cardback" alt="card" id="ophand1" style="width:5%;">
	<img src="Images/cardback" alt="card" id="ophand2" style="width:5%;">
	<img src="Images/cardback" alt="card" id="ophand3" style="width:5%;">
	<img src="Images/cardback" alt="card" id="ophand4" style="width:5%;">
	<img src="Images/cardback" alt="card" id="ophand5" style="width:5%;">
	<img src="Images/cardback" alt="card" id="ophand6" style="width:5%;">
	<img src="Images/cardback" alt="card" id="ophand7" style="width:5%;">
	<img src="Images/cardback" alt="card" id="ophand8" style="width:5%;">
	<img src="Images/cardback" alt="card" id="ophand9" style="width:5%;">
	<img src="Images/cardback" alt="card" id="ophand10" style="width:5%;">
</div> 
<br><br>
<!-- Opponent cards on board -->
<div class="container">
	<img src="Images/empty.png" alt="card" id="opboard9" style="width:6%;">
	<img src="Images/empty.png" alt="card" id="opboard8" style="width:6%;">
	<img src="Images/empty.png" alt="card" id="opboard7" style="width:6%;">
	<img src="Images/empty.png" alt="card" id="opboard6" style="width:6%;">
	<img src="Images/empty.png" alt="card" id="opboard5" style="width:6%;">
	<img src="Images/empty.png" alt="card" id="opboard4" style="width:6%;">
	<img src="Images/empty.png" alt="card" id="opboard3" style="width:6%;">
	<img src="Images/empty.png" alt="card" id="opboard2" style="width:6%;">
	<img src="Images/empty.png" alt="card" id="opboard1" style="width:6%;">
	<img src="Images/empty.png" alt="card" id="opboard0" style="width:6%;">
</div> 
<br><br><br>

<!-- Player cards on board -->
<div class="container">
	<div class="button">
		<button id="lookForUpdatesBTN" onclick="lookForUpdates()">Look for updates!</button>
	</div>
	<br>
	<div class="button">
		<button id="drawCardBTN" onclick="drawCard()">Draw a card!</button>
	</div>
	<div class="button">
			<button id="endTurnBTN" onclick="endTurn()">End turn!</button>
	</div>
	<img src="Images/empty.png" alt="empty" id="pboard0" onclick="playCard(this)" style="width:6%;">
	<img src="Images/empty.png" alt="empty" id="pboard1" onclick="playCard(this)" style="width:6%;">
	<img src="Images/empty.png" alt="empty" id="pboard2" onclick="playCard(this)" style="width:6%;">
	<img src="Images/empty.png" alt="empty" id="pboard3" onclick="playCard(this)" style="width:6%;">
	<img src="Images/empty.png" alt="empty" id="pboard4" onclick="playCard(this)" style="width:6%;">
	<img src="Images/empty.png" alt="empty" id="pboard5" onclick="playCard(this)" style="width:6%;">
	<img src="Images/empty.png" alt="empty" id="pboard6" onclick="playCard(this)" style="width:6%;">
	<img src="Images/empty.png" alt="empty" id="pboard7" onclick="playCard(this)" style="width:6%;">
	<img src="Images/empty.png" alt="empty" id="pboard8" onclick="playCard(this)" style="width:6%;">
	<img src="Images/empty.png" alt="empty" id="pboard9" onclick="playCard(this)" style="width:6%;">
</div> 

<br><br>
<br>
<!-- Player cards in hand -->
<div class="container">
	<img src="Images/card" alt="card" id="phand1" onclick="selectcard(this)" style="width:5%;">
	<img src="Images/card" alt="card" id="phand2" onclick="selectcard(this)" style="width:5%;">
	<img src="Images/card" alt="card" id="phand3" onclick="selectcard(this)" style="width:5%;">
	<img src="Images/card" alt="card" id="phand4" onclick="selectcard(this)" style="width:5%;">
	<img src="Images/card" alt="card" id="phand5" onclick="selectcard(this)" style="width:5%;">
	<img src="Images/card" alt="card" id="phand6" onclick="selectcard(this)" style="width:5%;">
	<img src="Images/card" alt="card" id="phand7" onclick="selectcard(this)" style="width:5%;">
	<img src="Images/card" alt="card" id="phand8" onclick="selectcard(this)" style="width:5%;">
	<img src="Images/card" alt="card" id="phand9" onclick="selectcard(this)" style="width:5%;">
	<img src="Images/card" alt="card" id="phand10" onclick="selectcard(this)" style="width:5%;">
</div> 



	
<script type="text/javascript">

	//NEXT TODO: Figure out how to save gameid and playerid (both players)
	// What card id to send and how to send place on board (place on board might just need to be the number)
	// How to take all this scripting and put it in a seperate file. 

	//Get game and playerid from somewhere when this page is started


	var selectedCard = "0"; //Handles the card that is currently selected.

	function selectcard(card){
		selectedCard = card;
	}

	function playCard(pos){
		console.log(selectedCard.src);
		console.log(pos.src);
		if (selectedCard.alt != "card" || pos.alt != "empty") {
			console.log(true);
			return;
		}

		const gameId = sessionStorage.getItem("gameId");
		const playerId = sessionStorage.getItem("playerId");
		const boardId = pos.id;
		//const cardId = pos.src.substring(29, pos.src.length); //Stupid workaround to cardname from img source
		const cardId = 'card1';
		console.log("Card" + cardId);

		const url = `http://localhost:8080/playCard/${gameId}/${playerId}/${cardId}/${pos.id}`;
		const xhr = new XMLHttpRequest();
		xhr.open("GET", url);
		xhr.send();

		xhr.onload = function() {
			console.log("BEFORE");
			var update = xhr.response;
			console.log(update);
			console.log("Change card");
			//Card is actually played. Figure out how to show game from this xhr response

			document.getElementById(pos.id).src = selectedCard.src;
			document.getElementById(pos.id).alt = "card";
			document.getElementById(selectedCard.id).src = "Images/empty.png";
			document.getElementById(selectedCard.id).alt = "empty";
		}
		
	}

	function endTurn(){
		const url = 'http://localhost:8080/endTurn/';
		const xhr = new XMLHttpRequest();
		xhr.open("PUT", url);
		xhr.send();
		document.getElementById("EndTurnBTN").disabled = true;
	}
</script>
	
	<script type="text/javascript" id="APICallDrawCardFunc">
		function drawCard() {
			const gameId = sessionStorage.getItem("gameId");
			const playerId = sessionStorage.getItem("playerId");
			const url = `http://localhost:8080/drawCard/${gameId}/${playerId}`;
			const xhr = new XMLHttpRequest();
			xhr.open("GET", url);
			xhr.send();

			
			
		}
	</script>

	<script type="text/javascript" id="APICallLookForUpdatesFunc">
		function lookForUpdates() {
			var gameId = sessionStorage.getItem("gameId");
			const url = `http://localhost:8080/getGame/${gameId}`;
			const xhr = new XMLHttpRequest();
			xhr.open("GET", url);
			xhr.send();
			
			xhr.onreadystatechange = processreq;



			//Act on the data received from the request
			function processreq(e) { 
				if (xhr.readyState == 4 && xhr.status == 200) {
					const data =  JSON.parse(xhr.response);
					console.log("Data from look for updates request at: " + url + ":\n" + data);
					console.log("Player1: " + data.player1.deck[1].cost);
					console.log("Player2: " + data[1]);
				}
			}

			//document.getElementById("opponentCard").innerHTML = "Your opponent has drawn: " +  "nothing yet because this function needs implementation ";
			
		}
		
	</script>

</body>
</html>